<!DOCTYPE aesl-source>
<network>


<!--list of global events-->


<!--list of constants-->


<!--show keywords state-->
<keywords flag="true"/>


<!--node thymio-II-->
<node nodeId="1" name="thymio-II">var compteur2 = 0
var compteur3 = 0
var compteur4 = 0
var state = 0

########################################################################################################################

onevent button.forward

timer.period[0] = 50
timer.period[1] = 100
motor.left.target = 100
motor.right.target = 100
state = 1

########################################################################################################################

onevent timer0
if prox.horizontal[0] != 0 and prox.horizontal[1] != 0 and prox.horizontal[2] != 0 and prox.horizontal[3] == 0 and prox.horizontal[4] == 0 then

	state = 2
	
#####
    #
##  #
 #  #
 
######################################################

elseif prox.horizontal[0] == 0 and prox.horizontal[1] == 0 and prox.horizontal[2] != 0 and prox.horizontal[3] != 0 and prox.horizontal[4] != 0  then

	state = 3

#####
#
#  ##
#  #

######################################################

elseif prox.horizontal[0] == 0 and prox.horizontal[1] == 0 and prox.horizontal[2]  == 0 and prox.horizontal[3] == 0 and prox.horizontal[4] == 0  then

	state = 2

######

##  ##
 #  #

######################################################

elseif prox.horizontal[0] != 0 and prox.horizontal[1] != 0 and prox.horizontal[2] != 0 and prox.horizontal[3] != 0 and prox.horizontal[4] != 0  then
	
	state = 5

end 

#####
#   #
#   3
#   3

######################################################
	
if  prox.horizontal[0] > 2500 and prox.horizontal[4] > 2500 then

	motor.left.target = 100
	motor.right.target = 100
end

########################################################################################################################

onevent timer1

if  state == 1 then
	
	motor.left.target = 100
	motor.right.target = 100

######################################################

elseif  state == 2 then
	
	compteur2++
	if  compteur2 &lt; 10 then
	
		motor.left.target = 100
		motor.right.target = 100
	
	elseif compteur2 > 10 then

		motor.left.target = 250
		motor.right.target = 80
	end 	
		
	if  compteur2 >= 41 then
		compteur2 = 0
		state = 0
	end
	
######################################################

elseif  state == 3 then

	compteur3++
	if  compteur3 &lt; 10 then
	
		motor.left.target = 100
		motor.right.target = 100
	
	elseif compteur3 > 10 then

		motor.left.target =  80
		motor.right.target = 250
	end 	
		
	if  compteur3 >= 41 then
		compteur3 = 0
		state = 0
	end

######################################################

elseif  state == 4 then

	compteur4++
	if  compteur4 &lt; 90 then
	
		motor.left.target = -100
		motor.right.target = 100
	end 	
		
	if  compteur4 >= 90 then
		compteur4 = 0
		state = 1
	end

end

########################################################################################################################

onevent button.backward

motor.left.target = 0
motor.right.target = 0
timer.period[0] = 0
timer.period[1] = 0
compteur2 = 0
compteur3 = 0
compteur4 = 0
state = 0</node>


</network>
